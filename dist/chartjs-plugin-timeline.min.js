!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("chart.js"),require("moment")):"function"==typeof define&&define.amd?define(["chart.js","moment"],e):(t=t||self).Timeline=e(t.Chart,t.moment)}(this,(function(t,e){"use strict";t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t,e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e;var r=t.helpers;function a(t,e){if(r.isNullOrUndef(e))return null;var a=t.options.time,o=function(t,e){var a=t._adapter,o=t.options.time,n=o.parser,i=n||o.format,l=e;return"function"==typeof n&&(l=n(l)),r.isFinite(l)||(l="string"==typeof i?a.parse(l,i):a.parse(l)),null!==l?+l:(n||"function"!=typeof i||(l=i(e),r.isFinite(l)||(l=a.parse(l))),l)}(t,t.getRightValue(e));return null===o||a.round&&(o=+t._adapter.startOf(o,a.round)),o}function o(t,e){return t-e}var n=Number.MIN_SAFE_INTEGER||-9007199254740991,i=Number.MAX_SAFE_INTEGER||9007199254740991,l=t.scaleService.getScaleConstructor("time").extend({determineDataLimits:function(){var t,e,l,s,d,u,h,c=this,f=c.chart,g=c._adapter,p=c.options.time,m=p.unit||"day",y=i,x=n,b=[],v=[],k=[],_=(f.data.labels,c.chart.options.datasets.timeline),w={};for(t=0,l=(f.data.datasets||[]).length;t<l;++t)if(f.isDatasetVisible(t)){var C=f.data.datasets[t];if(d=C.data,r.isArray(d[0]))for(v[t]=[],e=0,s=d.length;e<s;++e)(u=a(c,d[e][C.keyStart||_.keyStart]))>(h=a(c,d[e][C.keyEnd||_.keyEnd]))&&([u,h]=[h,u]),y>u&&u&&(y=u),x<h&&h&&(x=h),v[t][e]=[u,h,d[e][C.keyValue||_.keyValue]],Object.prototype.hasOwnProperty.call(w,u)&&(w[u]=!0,b.push(u)),Object.prototype.hasOwnProperty.call(w,h)&&(w[h]=!0,b.push(h));else{for(e=0,s=k.length;e<s;++e)b.push(k[e]);v[t]=k.slice(0)}}else v[t]=[];b.length&&(b=function(t){var e,r,a,o={},n=[];for(e=0,r=t.length;e<r;++e)o[a=t[e]]||(o[a]=!0,n.push(a));return n}(b).sort(o),y=Math.min(y,b[0]),x=Math.max(x,b[b.length-1])),y=a(c,p.min)||y,x=a(c,p.max)||x,y=y===i?+g.startOf(Date.now(),m):y,x=x===n?+g.endOf(Date.now(),m)+1:x,c.min=Math.min(y,x),c.max=Math.max(y+1,x),c._horizontal=c.isHorizontal(),c._table=[],c._timestamps={data:b,datasets:v,labels:k}},_parseValue:function(t){var e,o,n,i;return r.isArray(t)?(e=+this.getRightValue(a(this,t[0])),o=+this.getRightValue(a(this,t[1])),n=Math.min(e,o),i=Math.max(e,o)):(e=void 0,o=t=+this.getRightValue(a(me,t)),n=t,i=t),{min:n,max:i,start:e,end:o}}});t.scaleService.registerScaleType("timeline",l,{position:"bottom",tooltips:{mode:"nearest"},adapters:{},time:{parser:!1,format:!1,unit:!1,round:!1,displayFormat:!1,isoWeekday:!1,minUnit:"millisecond",distribution:"linear",bounds:"data",displayFormats:{millisecond:"h:mm:ss.SSS a",second:"h:mm:ss a",minute:"h:mm a",hour:"hA",day:"MMM D",week:"ll",month:"MMM YYYY",quarter:"[Q]Q - YYYY",year:"YYYY"}},ticks:{autoSkip:!0}});var s=t.helpers;function d(t,e,r){return t===e?r:t===r?e:t}function u(t,e,r){var a,o,n,i,l=t.borderWidth,u=function(t){var e=t.borderSkipped,r={};return e?(t.horizontal?t.base>t.x&&(e=d(e,"left","right")):t.base<t.y&&(e=d(e,"bottom","top")),r[e]=!0,r):r}(t);return s.isObject(l)?(a=+l.top||0,o=+l.right||0,n=+l.bottom||0,i=+l.left||0):a=o=n=i=+l||0,{t:u.top||a<0?0:a>r?r:a,r:u.right||o<0?0:o>e?e:o,b:u.bottom||n<0?0:n>r?r:n,l:u.left||i<0?0:i>e?e:i}}function h(t){return{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height}}function c(t){var e=h(t),r=e.right-e.left,a=e.bottom-e.top,o=u(t,r/2,a/2);return{outer:{x:e.left,y:e.top,w:r,h:a},inner:{x:e.left+o.l,y:e.top+o.t,w:r-o.l-o.r,h:a-o.t-o.b}}}function f(t,e,r){var a,o,n=r.barThickness,i=(e.stackCount,e.pixels[t]),l=s.isNullOrUndef(n)?function(t,e){var r,a,o,n,i=t._length;for(o=1,n=e.length;o<n;++o)i=Math.min(i,Math.abs(e[o]-e[o-1]));for(o=0,n=t.getTicks().length;o<n;++o)a=t.getPixelForTick(o),i=o>0?Math.min(i,Math.abs(a-r)):i,r=a;return i}(e.scale,e.pixels):-1;return 1,s.isNullOrUndef(n)?(a=l*r.categoryPercentage,o=r.barPercentage):(a=1*n,o=1),{chunk:a/1,ratio:o,start:i-a/2}}t.controllers.timeline=t.controllers.bar.extend({_dataElementOptions:["backgroundColor","borderColor","borderSkipped","borderWidth","hoverBackgroundColor","hoverBorderColor","hoverBorderWidth"],_datasetOptions:["backgroundColor","borderColor","borderSkipped","borderWidth","hoverBackgroundColor","hoverBorderColor","hoverBorderWidth","barPercentage","barThickness","categoryPercentage","maxBarThickness","minBarLength","textPadding","showText","keyValue","keyStart","keyEnd"],initialize:function(){var e=this;t.controllers.bar.prototype.initialize.apply(e,arguments);var r=e.chart.options.elements;s._deprecated("timeline chart",r.colorFunction,"options.elements.colorFunction","dataset.backgroundColor")},_updateElementGeometry:function(e,r,a,o){var n=this;t.controllers.bar.prototype._updateElementGeometry.apply(n,arguments);var i=n.getDataset().data[r],l=e._xScale.getPixelForValue(i[o.keyStart]),d=e._xScale.getPixelForValue(i[o.keyEnd]),u=i[o.keyValue],f=n.getRuler(r),g=n.calculateBarIndexPixels(n.index,r,f,o),p=e._yScale.getPixelForValue(n.index,n.index);e._model.x=l,e._model.width=d-l,e._model.y=p-g.size/2,e._model.height=g.size,o.showText,e._model.text=u,e._model.textPadding=o.textPadding,e._model.fontColor=s.color(o.fontColor||t.defaults.global.defaultFontColor).rgbaString(),e._model.font=s.options._parseFont(o).string,e.draw=function(){var t=this._chart.ctx,e=this._view,r=c(e),a=r.outer,o=r.inner;(t.fillStyle=e.backgroundColor,t.fillRect(a.x,a.y,a.w,a.h),a.w===o.w&&a.h===o.h||(t.save(),t.beginPath(),t.rect(a.x,a.y,a.w,a.h),t.clip(),t.fillStyle=e.borderColor,t.rect(o.x,o.y,o.w,o.h),t.fill("evenodd"),t.restore()),e.text)&&(t.measureText(e.text).width>0&&(t.save(),t.beginPath(),t.rect(o.x,o.y,o.w,o.h),t.clip(),t.lineWidth=0,t.font=e.font,t.fillStyle=e.fontColor,t.textBaseline="middle",t.fillText(e.text,e.x+e.textPadding,e.y+e.height/2),t.restore()))},e.inXRange=function(t){var e=h(this._view);return t>=e.left&&t<=e.right},e.tooltipPosition=function(){var t=this.getCenterPoint();return{x:t.x,y:t.y}},e.getCenterPoint=function(){var t=this._view;return{x:t.x+t.width/2,y:t.y+t.height/2}},e.inRange=function(t,e){var r=!1;if(this._view){var a=h(this._view);r=t>=a.left&&t<=a.right&&e>=a.top&&e<=a.bottom}return r},e.getArea=function(){var t=this._view;return t.height*Math.abs(t.x-t.base)}},draw:function(t){var e,r,a=t||1,o=this.getMeta().data;for(e=0,r=o.length;e<r;e++)o[e].transition(a).draw()},calculateBarIndexPixels:function(t,e,r,a){var o="flex"===a.barThickness?function(t,e,r){var a,o=e.pixels,n=o[t],i=t>0?o[t-1]:null,l=t<o.length-1?o[t+1]:null,s=r.categoryPercentage;return null===i&&(i=n-(null===l?e.end-e.start:l-n)),null===l&&(l=n+n-i),a=n-(n-Math.min(i,l))/2*s,{chunk:Math.abs(l-i)/2*s/e.stackCount,ratio:r.barPercentage,start:a}}(e,r,a):f(e,r,a),n=this.getStackIndex(t,this.getMeta().stack),i=o.start+o.chunk*n+o.chunk/2,l=Math.min(s.valueOrDefault(a.maxBarThickness,1/0),o.chunk*o.ratio);return{base:i-l/2,head:i+l/2,center:i,size:l}},_resolveDataElementOptions:function(t,e){var r,a,o,n=this,i=n.chart,l=n.getDataset(),d=i.options.datasets.timeline,u=i.options.elements.rectangle||{},h={},c={chart:i,dataIndex:e,dataset:l,datasetIndex:n.index},f=n._datasetOptions;for(r=0,a=f.length;r<a;++r)h[o=f[r]]=s.options.resolve([l[o],d[o],u[o]],c,e);var g=n._dataElementOptions;for(r=0,a=g.length;r<a;++r)h[o=g[r]]=s.options.resolve([h[o],d[o],l[o],u[o]],c,e);return h},_getValueScaleId:function(){return this.getMeta().xAxisID},_getIndexScaleId:function(){return this.getMeta().yAxisID}}),t.defaults.timeline={elements:{rectangle:{backgroundColor:t.defaults.global.backgroundColor,borderColor:t.defaults.global.backgroundColor,borderWidth:0,borderSkipped:null,hoverBackgroundColor:s.getHoverColor(t.defaults.global.backgroundColor),hoverBorderColor:s.getHoverColor(t.defaults.global.borderColor),hoverBorderWidth:1,showText:!0,textPadding:4,minBarLength:5,fontColor:"#fff"}},datasets:{timeline:{categoryPercentage:.8,barPercentage:.9,keyStart:0,keyEnd:1,keyValue:2}},layout:{padding:{left:0,right:0,top:0,bottom:0}},legend:{display:!1},scales:{xAxes:[{type:"timeline",position:"bottom",distribution:"linear",gridLines:{display:!0,drawBorder:!0,drawTicks:!0},ticks:{maxRotation:0},unit:"day"}],yAxes:[{type:"category",position:"left",offset:!0,gridLines:{display:!0,offsetGridLines:!0,drawBorder:!0,drawTicks:!0}}]},tooltips:{callbacks:{title:function(t,e){this._chart.options.elements;return e.labels[t[0].datasetIndex]},label:function(t,r){var a=r.datasets[t.datasetIndex],o=r.datasets[t.datasetIndex].data[t.index];return[o[a.keyValue||2],e(o[a.keyStart||0]).format("L LTS"),e(o[a.keyEnd||1]).format("L LTS")]}}}};return{}}));
