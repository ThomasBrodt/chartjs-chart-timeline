!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("chart.js"),require("moment")):"function"==typeof define&&define.amd?define(["chart.js","moment"],e):e(t.Chart,t.moment)}(this,function(t,e){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t,e=e&&e.hasOwnProperty("default")?e.default:e;var a=t.helpers;function r(t,e){return t-e}function o(t,e){if(a.isNullOrUndef(e))return null;var r=t.options.time,o=function(t,e){var r=t._adapter,o=t.options.time,i=o.parser,n=i||o.format,l=e;return"function"==typeof i&&(l=i(l)),a.isFinite(l)||(l="string"==typeof n?r.parse(l,n):r.parse(l)),null!==l?+l:(i||"function"!=typeof n||(l=n(e),a.isFinite(l)||(l=r.parse(l))),l)}(t,t.getRightValue(e));return null===o?o:(r.round&&(o=+t._adapter.startOf(o,r.round)),o)}var i=Number.MIN_SAFE_INTEGER||-9007199254740991,n=Number.MAX_SAFE_INTEGER||9007199254740991,l=t.scaleService.getScaleConstructor("time").extend({determineDataLimits:function(){var t,e,l,s,d,h,c,u=this,g=u.chart,p=u._adapter,m=u.options.time,f=m.unit||"day",x=n,y=i,b=[],v=[],k=[],_=(g.data.labels,u.chart.options.elements),S={};for(t=0,l=(g.data.datasets||[]).length;t<l;++t)if(g.isDatasetVisible(t))if(d=g.data.datasets[t].data,a.isArray(d[0]))for(v[t]=[],e=0,s=d.length;e<s;++e)(h=o(u,d[e][_.keyStart]))>(c=o(u,d[e][_.keyEnd]))&&([h,c]=[c,h]),x>h&&h&&(x=h),y<c&&c&&(y=c),v[t][e]=[h,c,d[e][_.keyValue]],Object.prototype.hasOwnProperty.call(S,h)&&(S[h]=!0,b.push(h)),Object.prototype.hasOwnProperty.call(S,c)&&(S[c]=!0,b.push(c));else{for(e=0,s=k.length;e<s;++e)b.push(k[e]);v[t]=k.slice(0)}else v[t]=[];b.length&&(b=function(t){var e,a,r,o={},i=[];for(e=0,a=t.length;e<a;++e)o[r=t[e]]||(o[r]=!0,i.push(r));return i}(b).sort(r),x=Math.min(x,b[0]),y=Math.max(y,b[b.length-1])),x=o(u,m.min)||x,y=o(u,m.max)||y,x=x===n?+p.startOf(Date.now(),f):x,y=y===i?+p.endOf(Date.now(),f)+1:y,u.min=Math.min(x,y),u.max=Math.max(x+1,y),u._horizontal=u.isHorizontal(),u._table=[],u._timestamps={data:b,datasets:v,labels:k}},getPixelForValue:function(t,e,a){var r=null;if(void 0!==e&&void 0!==a&&(r=this._timestamps.datasets[a][e]),null===r&&(r=o(this,t)),null!==r)return this.getPixelForOffset(r)},_parseValue:function(t){var e,r,i,n;return a.isArray(t)?(e=+this.getRightValue(o(this,t[0])),r=+this.getRightValue(o(this,t[1])),i=Math.min(e,r),n=Math.max(e,r)):(e=void 0,r=t=+this.getRightValue(o(me,t)),i=t,n=t),{min:i,max:n,start:e,end:r}}});t.scaleService.registerScaleType("timeline",l,{position:"bottom",tooltips:{mode:"nearest"},adapters:{},time:{parser:!1,format:!1,unit:!1,round:!1,displayFormat:!1,isoWeekday:!1,minUnit:"millisecond",distribution:"linear",bounds:"data",displayFormats:{millisecond:"h:mm:ss.SSS a",second:"h:mm:ss a",minute:"h:mm a",hour:"hA",day:"MMM D",week:"ll",month:"MMM YYYY",quarter:"[Q]Q - YYYY",year:"YYYY"}},ticks:{autoSkip:!0}}),t.controllers.timeline=t.controllers.bar.extend({_dataElementOptions:["backgroundColor","borderColor","borderSkipped","borderWidth","hoverBackgroundColor","hoverBorderColor","hoverBorderWidth","barThickness","maxBarThickness","minBarLength","textPadding","showText","keyValue","keyStart","keyEnd"],getBarBounds:function(t){var e,a,r=t._view;return e=r.x,a=r.x+r.width,{left:e,top:r.y,right:a,bottom:r.y+r.height}},update:function(e){var r=this,o=r.getMeta(),i=r.chart.options;if(i.textPadding||i.minBarLength||i.showText||i.colorFunction){var n=r.chart.options.elements;n.textPadding=i.textPadding||n.textPadding,n.minBarLength=i.minBarLength||n.minBarLength,n.colorFunction=i.colorFunction||n.colorFunction,n.minBarLength=i.minBarLength||n.minBarLength,!0!==t._tl_depwarn&&(console.log("Timeline Chart: Configuration deprecated. Please check document on Github."),t._tl_depwarn=!0)}a.each(o.data,function(t,a){r.updateElement(t,a,e)},r)},updateElement:function(t,e,r){var o=this,i=o.getMeta(),n=o.getDataset(),l=o._resolveDataElementOptions(t,e),s=o.getScaleForId(i.xAxisID),d=o.getScaleForId(i.yAxisID),h=n.data[e],c=s.getPixelForValue(h[l.keyStart]),u=d.getPixelForValue(h,o.index,o.index),g=s.getPixelForValue(h[l.keyEnd])-c,p=o.getRuler(e),m=o.calculateBarHeight(p);t._xScale=o.getScaleForId(i.xAxisID),t._yScale=o.getScaleForId(i.yAxisID),t._datasetIndex=o.index,t._index=e,t._model={backgroundColor:l.backgroundColor,borderColor:l.borderColor,borderSkipped:l.borderSkipped,borderWidth:l.borderWidth,datasetLabel:n.label,label:o.chart.data.labels[e],x:r?c-g:c,y:u-m/2,width:Math.max(g,l.minBarLength),height:m,base:c+g,text:h[l.keyValue],textColor:a.color(l.backgroundColor).luminosity()>.5?"#000000":"#ffffff"};h[l.keyValue],l.showText;t.draw=function(){var t=this._chart.ctx,e=this._view,a=t.globalAlpha,r=t.globalCompositeOperation;t.fillStyle=e.backgroundColor,t.lineWidth=e.borderWidth,t.globalCompositeOperation="destination-over",t.fillRect(e.x,e.y,e.width,e.height),t.globalAlpha=.5,t.globalCompositeOperation="source-over",t.fillRect(e.x,e.y,e.width,e.height);var o=e.borderWidth||0;if(o>0&&(t.save(),t.beginPath(),t.rect(e.x,e.y,e.width,e.height),t.clip(),t.fillStyle=e.borderColor,t.rect(e.x+o,e.y+o,e.width-2*o,e.height-2*o),t.fill("evenodd"),t.restore()),t.globalAlpha=a,t.globalCompositeOperation=r,l.showText){t.beginPath();var i=t.measureText(e.text);i.width>0&&i.width+l.textPadding+2<e.width&&(l.font&&(t.font=l.font),t.fillStyle=e.textColor,t.lineWidth=0,t.strokeStyle=e.textColor,t.textBaseline="middle",t.fillText(e.text,e.x+l.textPadding,e.y+e.height/2)),t.fill()}},t.inXRange=function(t){var e=o.getBarBounds(this);return t>=e.left&&t<=e.right},t.tooltipPosition=function(){var t=this.getCenterPoint();return{x:t.x,y:t.y}},t.getCenterPoint=function(){var t=this._view;return{x:t.x+t.width/2,y:t.y+t.height/2}},t.inRange=function(t,e){var a=!1;if(this._view){var r=o.getBarBounds(this);a=t>=r.left&&t<=r.right&&e>=r.top&&e<=r.bottom}return a},t.pivot()},getBarCount:function(){var t=this,e=0;return a.each(t.chart.data.datasets,function(a,r){t.chart.getDatasetMeta(r).bar&&t.chart.isDatasetVisible(r)&&++e},t),e},draw:function(t){var e,a,r=t||1,o=this.getMeta().data;for(e=0,a=o.length;e<a;e++)o[e].transition(r).draw()},calculateBarHeight:function(t){var e=this.getScaleForId(this.getMeta().yAxisID);return e.options.barThickness?e.options.barThickness:e.options.stacked?t.categoryHeight:t.barHeight},_resolveElementOptions:function(t,e){var r,o,i,n=this.chart,l=this.getDataset(),s=t.custom||{},d=n.options.elements||{},h={},c={chart:n,dataIndex:e,dataset:l,datasetIndex:this.index},u=["backgroundColor","borderColor","borderSkipped","borderWidth","hoverBackgroundColor","hoverBorderColor","hoverBorderWidth"];for(r=0,o=u.length;r<o;++r)h[i=u[r]]=a.options.resolve([s[i],l[i],d[i]],c,e);return h},_resolveDataElementOptions:function(t,e){var r=a.options.resolve,o=this,i=t&&t.custom,n=o._cachedDataOpts;if(n&&!i)return n;var l,s,d,h,c=o.chart,u=o._config,g=c.options.elements[o.dataElementType.prototype._type]||{},p=o._dataElementOptions,m={},f={chart:c,dataIndex:e,dataset:o.getDataset(),datasetIndex:o.index},x={cacheable:!i};if(i=i||{},a.isArray(p))for(s=0,d=p.length;s<d;++s)m[h=p[s]]=r([i[h],u[h],g[h]],f,e,x);else for(s=0,d=(l=Object.keys(p)).length;s<d;++s)m[h=l[s]]=r([i[h],u[p[h]],u[h],g[h]],f,e,x);g.keyStart||(g.keyStart=0),g.keyEnd||(g.keyEnd=1),g.keyValue||(g.keyValue=2),g.minBarLength||(g.minBarLength=40),g.showText||(g.showText=!0),g.textPadding||(g.textPadding=4),x.cacheable&&(o._cachedDataOpts=Object.freeze(m));o._getIndexScale().options,o._getValueScale().options;return m},_getValueScaleId:function(){return this.getMeta().xAxisID},_getIndexScaleId:function(){return this.getMeta().yAxisID}}),t.defaults.timeline={elements:{backgroundColor:"gold",borderColor:"orange",borderWidth:2,hoverBackgroundColor:"orange",hoverBorderColor:"red",hoverBorderWidth:1,showText:!0,textPadding:4,minBarLength:5,keyStart:0,keyEnd:1,keyValue:2},layout:{padding:{left:0,right:0,top:0,bottom:0}},legend:{display:!1},scales:{xAxes:[{type:"timeline",position:"bottom",distribution:"linear",gridLines:{display:!0,drawBorder:!0,drawTicks:!0},ticks:{maxRotation:0},unit:"day"}],yAxes:[{type:"category",position:"left",barThickness:20,categoryPercentage:.9,barPercentage:.7,offset:!0,gridLines:{display:!0,offsetGridLines:!0,drawBorder:!0,drawTicks:!0}}]},tooltips:{callbacks:{title:function(t,e){this._chart.options.elements;return e.labels[t[0].datasetIndex]},label:function(t,a){var r=this._chart.options.elements,o=a.datasets[t.datasetIndex].data[t.index];return[o[r.keyValue],e(o[r.keyStart]).format("L LTS"),e(o[r.keyEnd]).format("L LTS")]}}}}});
