!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("chart.js"),require("moment")):"function"==typeof define&&define.amd?define(["chart.js","moment"],e):e(t.Chart,t.moment)}(this,function(t,e){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t,e=e&&e.hasOwnProperty("default")?e.default:e;var r=t.helpers;function o(t,o){if(r.isNullOrUndef(t))return null;var a=o.options.time,i=function(t,r){var o=r.parser,a=r.parser||r.format;return"function"==typeof o?o(t):"string"==typeof t&&"string"==typeof a?e(t,a):(t instanceof e||(t=e(t)),t.isValid()?t:"function"==typeof a?a(t):t)}(o.getRightValue(t),a);return i.isValid()?(a.round&&i.startOf(a.round),i.valueOf()):null}var a=Number.MIN_SAFE_INTEGER||-9007199254740991,i=Number.MAX_SAFE_INTEGER||9007199254740991,n=t.scaleService.getScaleConstructor("time").extend({determineDataLimits:function(){var t,r,n,l,d,s,h,c=this,u=c.chart,f=c.options.time,g=c.chart.options.elements,m=i,p=a,b=[],y={},x=[];for(t=0,n=(u.data.datasets||[]).length;t<n;++t)if(u.isDatasetVisible(t))for(d=u.data.datasets[t].data,x[t]=[],r=0,l=d.length;r<l;++r)(s=o(d[r][g.keyStart],c))>(h=o(d[r][g.keyEnd],c))&&([s,h]=[h,s]),m>s&&s&&(m=s),p<h&&h&&(p=h),x[t][r]=[s,h,d[r][g.keyValue]],Object.prototype.hasOwnProperty.call(y,s)&&(y[s]=!0,b.push(s)),Object.prototype.hasOwnProperty.call(y,h)&&(y[h]=!0,b.push(h));else x[t]=[];b.size&&b.sort(function(t,e){return t-e}),m=o(f.min,c)||m,p=o(f.max,c)||p,m=m===i?+e().startOf("day"):m,p=p===a?+e().endOf("day")+1:p,c.min=Math.min(m,p),c.max=Math.max(m+1,p),c._horizontal=c.isHorizontal(),c._table=[],c._timestamps={data:b,datasets:x,labels:[]}}});t.scaleService.registerScaleType("timeline",n,{position:"bottom",tooltips:{mode:"nearest"},adapters:{},time:{parser:!1,format:!1,unit:!1,round:!1,displayFormat:!1,isoWeekday:!1,minUnit:"millisecond",distribution:"linear",bounds:"data",displayFormats:{millisecond:"h:mm:ss.SSS a",second:"h:mm:ss a",minute:"h:mm a",hour:"hA",day:"MMM D",week:"ll",month:"MMM YYYY",quarter:"[Q]Q - YYYY",year:"YYYY"}},ticks:{autoSkip:!0}}),t.controllers.timeline=t.controllers.bar.extend({getBarBounds:function(t){var e,r,o=t._view;return e=o.x,r=o.x+o.width,{left:e,top:o.y,right:r,bottom:o.y+o.height}},update:function(e){var o=this,a=o.getMeta(),i=o.chart.options;if(i.textPadding||i.minBarWidth||i.showText||i.colorFunction){var n=o.chart.options.elements;n.textPadding=i.textPadding||n.textPadding,n.minBarWidth=i.minBarWidth||n.minBarWidth,n.colorFunction=i.colorFunction||n.colorFunction,n.minBarWidth=i.minBarWidth||n.minBarWidth,!0!==t._tl_depwarn&&(console.log("Timeline Chart: Configuration deprecated. Please check document on Github."),t._tl_depwarn=!0)}r.each(a.data,function(t,r){o.updateElement(t,r,e)},o)},updateElement:function(e,o,a){var i=this,n=i.getMeta(),l=i.getDataset(),d=i.getScaleForId(n.xAxisID),s=i.getScaleForId(n.yAxisID);e._xScale=d,e._yScale=s,e._datasetIndex=i.index,e._index=o;var h=l.data[o],c=e.custom||{},u=i.index,f=i.chart.options.elements||t.defaults.timeline.elements,g=f.rectangle,m=f.textPadding,p=f.minBarWidth,b=h[f.keyValue],y=i.getRuler(o),x=d.getPixelForValue(h[f.keyStart]),v=d.getPixelForValue(h[f.keyEnd]),k=s.getPixelForValue(h,u,u),w=v-x,C=i.calculateBarHeight(y),S=r.color(l.backgroundColor||f.backgroundColor),B=f.showText,P=(r.color(l.borderColor||f.borderColor),l.borderWidth||f.borderWidth,f.font);P||(P='bold 12px "Helvetica Neue", Helvetica, Arial, sans-serif');var W=k-C/2;e._model={x:a?x-w:x,y:W,width:Math.max(w,p),height:C,base:x+w,backgroundColor:S.rgbaString(),borderSkipped:c.borderSkipped?c.borderSkipped:g.borderSkipped,borderColor:c.borderColor?c.borderColor:r.getValueAtIndexOrDefault(l.borderColor,o,g.borderColor),borderWidth:c.borderWidth?c.borderWidth:r.getValueAtIndexOrDefault(l.borderWidth,o,g.borderWidth),label:i.chart.data.labels[o],datasetLabel:l.label,text:b,textColor:S.luminosity()>.5?"#000000":"#ffffff"},e.draw=function(){var t=this._chart.ctx,e=this._view,r=t.globalAlpha,o=t.globalCompositeOperation;t.fillStyle=e.backgroundColor,t.lineWidth=e.borderWidth,t.globalCompositeOperation="destination-over",t.fillRect(e.x,e.y,e.width,e.height),t.globalAlpha=.5,t.globalCompositeOperation="source-over",t.fillRect(e.x,e.y,e.width,e.height);var a=e.borderWidth||0;if(a>0&&(t.save(),t.beginPath(),t.rect(e.x,e.y,e.width,e.height),t.clip(),t.fillStyle=e.borderColor,t.rect(e.x+a,e.y+a,e.width-2*a,e.height-2*a),t.fill("evenodd"),t.restore()),t.globalAlpha=r,t.globalCompositeOperation=o,B){t.beginPath();var i=t.measureText(e.text);i.width>0&&i.width+m+2<e.width&&(t.font=P,t.fillStyle=e.textColor,t.lineWidth=0,t.strokeStyle=e.textColor,t.textBaseline="middle",t.fillText(e.text,e.x+m,e.y+e.height/2)),t.fill()}},e.inXRange=function(t){var e=i.getBarBounds(this);return t>=e.left&&t<=e.right},e.tooltipPosition=function(){var t=this.getCenterPoint();return{x:t.x,y:t.y}},e.getCenterPoint=function(){var t=this._view;return{x:t.x+t.width/2,y:t.y+t.height/2}},e.inRange=function(t,e){var r=!1;if(this._view){var o=i.getBarBounds(this);r=t>=o.left&&t<=o.right&&e>=o.top&&e<=o.bottom}return r},e.pivot()},getBarCount:function(){var t=this,e=0;return r.each(t.chart.data.datasets,function(r,o){t.chart.getDatasetMeta(o).bar&&t.chart.isDatasetVisible(o)&&++e},t),e},draw:function(t){var e,r,o=t||1,a=this.getMeta().data;for(e=0,r=a.length;e<r;e++)a[e].transition(o).draw()},calculateBarHeight:function(t){var e=this.getScaleForId(this.getMeta().yAxisID);return e.options.barThickness?e.options.barThickness:e.options.stacked?t.categoryHeight:t.barHeight}}),t.defaults.timeline={elements:{colorFunction:function(){return r.color("black")},backgroundColor:"gold",borderColor:"orange",borderWidth:2,hoverBackgroundColor:"orange",hoverBorderColor:"red",hoverBorderWidth:1,showText:!0,textPadding:4,minBarWidth:1,keyStart:0,keyEnd:1,keyValue:2},layout:{padding:{left:0,right:0,top:0,bottom:0}},legend:{display:!1},scales:{xAxes:[{type:"timeline",position:"bottom",distribution:"linear",categoryPercentage:.8,barPercentage:.9,gridLines:{display:!0,drawBorder:!0,drawTicks:!0},ticks:{maxRotation:0},unit:"day"}],yAxes:[{type:"category",position:"left",barThickness:20,categoryPercentage:.8,barPercentage:.9,offset:!0,gridLines:{display:!0,offsetGridLines:!0,drawBorder:!0,drawTicks:!0}}]},tooltips:{callbacks:{title:function(t,e){this._chart.options.elements;return e.labels[t[0].datasetIndex]},label:function(t,r){var o=this._chart.options.elements,a=r.datasets[t.datasetIndex].data[t.index];return[a[o.keyValue],e(a[o.keyStart]).format("L LTS"),e(a[o.keyEnd]).format("L LTS")]}}}}});
