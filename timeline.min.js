!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("chart.js"),require("moment")):"function"==typeof define&&define.amd?define(["chart.js","moment"],t):t(e.Chart,e.moment)}(this,function(e,t){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e,t=t&&t.hasOwnProperty("default")?t.default:t;var r=e.helpers;function a(e,t){return e-t}function o(e,t){if(r.isNullOrUndef(t))return null;var a=e.options.time,o=function(e,t){var a=e._adapter,o=e.options.time,n=o.parser,i=n||o.format,l=t;return"function"==typeof n&&(l=n(l)),r.isFinite(l)||(l="string"==typeof i?a.parse(l,i):a.parse(l)),null!==l?+l:(n||"function"!=typeof i||(l=i(t),r.isFinite(l)||(l=a.parse(l))),l)}(e,e.getRightValue(t));return null===o?o:(a.round&&(o=+e._adapter.startOf(o,a.round)),o)}var n=Number.MIN_SAFE_INTEGER||-9007199254740991,i=Number.MAX_SAFE_INTEGER||9007199254740991,l=e.scaleService.getScaleConstructor("time").extend({determineDataLimits:function(){var e,t,l,s,d,h,u,c=this,m=c.chart,g=c._adapter,f=c.options.time,p=f.unit||"day",x=i,y=n,b=[],k=[],v=[],_=(m.data.labels,c.chart.options.elements),S={};for(e=0,l=(m.data.datasets||[]).length;e<l;++e)if(m.isDatasetVisible(e))if(d=m.data.datasets[e].data,r.isArray(d[0]))for(k[e]=[],t=0,s=d.length;t<s;++t)(h=o(c,d[t][_.keyStart]))>(u=o(c,d[t][_.keyEnd]))&&([h,u]=[u,h]),x>h&&h&&(x=h),y<u&&u&&(y=u),k[e][t]=[h,u,d[t][_.keyValue]],Object.prototype.hasOwnProperty.call(S,h)&&(S[h]=!0,b.push(h)),Object.prototype.hasOwnProperty.call(S,u)&&(S[u]=!0,b.push(u));else{for(t=0,s=v.length;t<s;++t)b.push(v[t]);k[e]=v.slice(0)}else k[e]=[];b.length&&(b=function(e){var t,r,a,o={},n=[];for(t=0,r=e.length;t<r;++t)o[a=e[t]]||(o[a]=!0,n.push(a));return n}(b).sort(a),x=Math.min(x,b[0]),y=Math.max(y,b[b.length-1])),x=o(c,f.min)||x,y=o(c,f.max)||y,x=x===i?+g.startOf(Date.now(),p):x,y=y===n?+g.endOf(Date.now(),p)+1:y,c.min=Math.min(x,y),c.max=Math.max(x+1,y),c._horizontal=c.isHorizontal(),c._table=[],c._timestamps={data:b,datasets:k,labels:v}},getPixelForValue:function(e,t,r,a){var n=null;if(void 0!==t&&void 0!==r&&void 0!==a&&(n=this._timestamps.datasets[r][t][a]),null===n&&(n=o(this,e)),null!==n)return this.getPixelForOffset(n)},_parseValue:function(e){var t,a,n,i;return r.isArray(e)?(t=+this.getRightValue(o(this,e[0])),a=+this.getRightValue(o(this,e[1])),n=Math.min(t,a),i=Math.max(t,a)):(t=void 0,a=e=+this.getRightValue(o(me,e)),n=e,i=e),{min:n,max:i,start:t,end:a}}});function s(e,t,r){return e===t?r:e===r?t:e}function d(e,t,a){var o,n,i,l,d=e.borderWidth,h=function(e){var t=e.borderSkipped,r={};return t?(e.horizontal?e.base>e.x&&(t=s(t,"left","right")):e.base<e.y&&(t=s(t,"bottom","top")),r[t]=!0,r):r}(e);return r.isObject(d)?(o=+d.top||0,n=+d.right||0,i=+d.bottom||0,l=+d.left||0):o=n=i=l=+d||0,{t:h.top||o<0?0:o>a?a:o,r:h.right||n<0?0:n>t?t:n,b:h.bottom||i<0?0:i>a?a:i,l:h.left||l<0?0:l>t?t:l}}function h(e,t,a){var o,n,i=a.barThickness,l=(t.stackCount,t.pixels[e]),s=r.isNullOrUndef(i)?function(e,t){var r,a,o,n,i=e._length;for(o=1,n=t.length;o<n;++o)i=Math.min(i,Math.abs(t[o]-t[o-1]));for(o=0,n=e.getTicks().length;o<n;++o)a=e.getPixelForTick(o),i=o>0?Math.min(i,Math.abs(a-r)):i,r=a;return i}(t.scale,t.pixels):-1;return 1,r.isNullOrUndef(i)?(o=s*a.categoryPercentage,n=a.barPercentage):(o=1*i,n=1),console.log("chunk: "+o/1+" ratio: "+n+" start: "+(l-o/2)),{chunk:o/1,ratio:n,start:l-o/2}}e.scaleService.registerScaleType("timeline",l,{position:"bottom",tooltips:{mode:"nearest"},adapters:{},time:{parser:!1,format:!1,unit:!1,round:!1,displayFormat:!1,isoWeekday:!1,minUnit:"millisecond",distribution:"linear",bounds:"data",displayFormats:{millisecond:"h:mm:ss.SSS a",second:"h:mm:ss a",minute:"h:mm a",hour:"hA",day:"MMM D",week:"ll",month:"MMM YYYY",quarter:"[Q]Q - YYYY",year:"YYYY"}},ticks:{autoSkip:!0}}),e.controllers.timeline=e.controllers.bar.extend({_dataElementOptions:["backgroundColor","borderColor","borderSkipped","borderWidth","hoverBackgroundColor","hoverBorderColor","hoverBorderWidth","barPercentage","barThickness","categoryPercentage","maxBarThickness","minBarLength","textPadding","showText","keyValue","keyStart","keyEnd"],update:function(e){var t,r,a=this.getMeta().data;for(this._ruler=this.getRuler(),t=0,r=a.length;t<r;++t)this.updateElement(a[t],t,e)},_updateElementGeometry:function(t,r,a,o){var n=this;e.controllers.bar.prototype._updateElementGeometry.apply(n,arguments);var i=n.getDataset().data[r],l=t._xScale.getPixelForValue(i,r,n.index,o.keyStart||0),s=t._xScale.getPixelForValue(i,r,n.index,o.keyEnd||1),h=i[o.keyValue||2],u=n.getRuler(r),c=n.calculateBarIndexPixels(n.index,r,u,o),m=t._yScale.getPixelForValue(n.index,n.index);t._model.x=l,t._model.width=s-l,t._model.y=m-c.size/2,t._model.height=c.size,console.log("base: "+c.base+" head: "+c.head+" center: "+c.center+" size: "+c.size+" label: "+h),t._model.textPadding=o.textPadding||4,t._model.textColor=o.textColor||e.defaults.global.defaultFontColor,o.showText,t._model.text=h,t.draw=function(){var e=this._chart.ctx,t=this._view,r=function(e){var t=function(e){return{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height}}(e),r=t.right-t.left,a=t.bottom-t.top,o=d(e,r/2,a/2);return{outer:{x:t.left,y:t.top,w:r,h:a},inner:{x:t.left+o.l,y:t.top+o.t,w:r-o.l-o.r,h:a-o.t-o.b}}}(t),a=r.outer,o=r.inner;(e.fillStyle=t.backgroundColor,e.fillRect(a.x,a.y,a.w,a.h),a.w!==o.w||a.h!==o.h)&&(e.save(),e.beginPath(),e.rect(a.x,a.y,a.w,a.h),e.clip(),e.fillStyle=t.borderColor,e.rect(o.x,o.y,o.w,o.h),e.fill("evenodd"),e.restore(),t.text&&e.measureText(t.text).width>0&&(e.save(),e.beginPath(),e.rect(o.x,o.y,o.w,o.h),e.clip(),e.fillStyle=t.textColor,e.lineWidth=0,e.strokeStyle=t.textColor,e.textBaseline="middle",e.fillText(t.text,t.x+t.textPadding,t.y+t.height/2),e.restore()))}},draw:function(e){var t,r,a=e||1,o=this.getMeta().data;for(t=0,r=o.length;t<r;t++)o[t].transition(a).draw()},calculateBarIndexPixels:function(e,t,a,o){var n="flex"===o.barThickness?function(e,t,r){var a,o=t.pixels,n=o[e],i=e>0?o[e-1]:null,l=e<o.length-1?o[e+1]:null,s=r.categoryPercentage;return null===i&&(i=n-(null===l?t.end-t.start:l-n)),null===l&&(l=n+n-i),a=n-(n-Math.min(i,l))/2*s,{chunk:Math.abs(l-i)/2*s/t.stackCount,ratio:r.barPercentage,start:a}}(t,a,o):h(t,a,o),i=this.getStackIndex(e,this.getMeta().stack),l=n.start+n.chunk*i+n.chunk/2,s=Math.min(r.valueOrDefault(o.maxBarThickness,1/0),n.chunk*n.ratio);return{base:l-s/2,head:l+s/2,center:l,size:s}},_resolveElementOptions:function(e,t){var a,o,n,i=this.chart,l=this.getDataset(),s=e.custom||{},d=i.options.elements||{},h={},u={chart:i,dataIndex:t,dataset:l,datasetIndex:this.index},c=["backgroundColor","borderColor","borderWidth","borderSkipped","hoverBackgroundColor","hoverBorderColor","hoverBorderWidth","barThickness","maxBarThickness","minBarLength","textPadding","textColor","showText","keyValue","keyStart","keyEnd"];for(a=0,o=c.length;a<o;++a)h[n=c[a]]=r.options.resolve([s[n],l[n],d[n]],u,t);return h},_getValueScaleId:function(){return this.getMeta().xAxisID},_getIndexScaleId:function(){return this.getMeta().yAxisID}}),e.defaults._set("global",{datasets:{timeline:{categoryPercentage:.8,barPercentage:.9}}}),e.defaults.timeline={elements:{backgroundColor:"gold",borderColor:"orange",borderWidth:2,borderSkipped:"left",hoverBackgroundColor:"orange",hoverBorderColor:"red",hoverBorderWidth:1,showText:!0,textPadding:4,minBarLength:5,keyStart:0,keyEnd:1,keyValue:2,categoryPercentage:.9,barPercentage:.7},layout:{padding:{left:0,right:0,top:0,bottom:0}},legend:{display:!1},scales:{xAxes:[{type:"timeline",position:"bottom",distribution:"linear",gridLines:{display:!0,drawBorder:!0,drawTicks:!0},ticks:{maxRotation:0},unit:"day"}],yAxes:[{type:"category",position:"left",offset:!0,gridLines:{display:!0,offsetGridLines:!0,drawBorder:!0,drawTicks:!0}}]},tooltips:{callbacks:{title:function(e,t){this._chart.options.elements;return t.labels[e[0].datasetIndex]},label:function(e,r){var a=this._chart.options.elements,o=r.datasets[e.datasetIndex].data[e.index];return[o[a.keyValue],t(o[a.keyStart]).format("L LTS"),t(o[a.keyEnd]).format("L LTS")]}}}}});
