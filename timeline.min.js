!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("chart.js"),require("moment")):"function"==typeof define&&define.amd?define(["chart.js","moment"],e):e(t.Chart,t.moment)}(this,function(t,e){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t,e=e&&e.hasOwnProperty("default")?e.default:e;var r=t.helpers;function a(t,e){return t-e}function n(t,e){if(r.isNullOrUndef(e))return null;var a=t.options.time,n=function(t,e){var a=t._adapter,n=t.options.time,i=n.parser,o=i||n.format,l=e;return"function"==typeof i&&(l=i(l)),r.isFinite(l)||(l="string"==typeof o?a.parse(l,o):a.parse(l)),null!==l?+l:(i||"function"!=typeof o||(l=o(e),r.isFinite(l)||(l=a.parse(l))),l)}(t,t.getRightValue(e));return null===n?n:(a.round&&(n=+t._adapter.startOf(n,a.round)),n)}var i=Number.MIN_SAFE_INTEGER||-9007199254740991,o=Number.MAX_SAFE_INTEGER||9007199254740991,l=t.scaleService.getScaleConstructor("time").extend({determineDataLimits:function(){var t,e,l,s,d,h,u,c=this,g=c.chart,f=c._adapter,m=c.options.time,p=m.unit||"day",x=o,y=i,b=[],k=[],v=[],_=(g.data.labels,c.chart.options.elements),w={};for(t=0,l=(g.data.datasets||[]).length;t<l;++t)if(g.isDatasetVisible(t))if(d=g.data.datasets[t].data,r.isArray(d[0]))for(k[t]=[],e=0,s=d.length;e<s;++e)(h=n(c,d[e][_.keyStart]))>(u=n(c,d[e][_.keyEnd]))&&([h,u]=[u,h]),x>h&&h&&(x=h),y<u&&u&&(y=u),k[t][e]=[h,u,d[e][_.keyValue]],Object.prototype.hasOwnProperty.call(w,h)&&(w[h]=!0,b.push(h)),Object.prototype.hasOwnProperty.call(w,u)&&(w[u]=!0,b.push(u));else{for(e=0,s=v.length;e<s;++e)b.push(v[e]);k[t]=v.slice(0)}else k[t]=[];b.length&&(b=function(t){var e,r,a,n={},i=[];for(e=0,r=t.length;e<r;++e)n[a=t[e]]||(n[a]=!0,i.push(a));return i}(b).sort(a),x=Math.min(x,b[0]),y=Math.max(y,b[b.length-1])),x=n(c,m.min)||x,y=n(c,m.max)||y,x=x===o?+f.startOf(Date.now(),p):x,y=y===i?+f.endOf(Date.now(),p)+1:y,c.min=Math.min(x,y),c.max=Math.max(x+1,y),c._horizontal=c.isHorizontal(),c._table=[],c._timestamps={data:b,datasets:k,labels:v}},getPixelForValue:function(t,e,r,a){var i=null;if(void 0!==e&&void 0!==r&&void 0!==a&&(i=this._timestamps.datasets[r][e][a]),null===i&&(i=n(this,t)),null!==i)return this.getPixelForOffset(i)},_parseValue:function(t){var e,a,i,o;return r.isArray(t)?(e=+this.getRightValue(n(this,t[0])),a=+this.getRightValue(n(this,t[1])),i=Math.min(e,a),o=Math.max(e,a)):(e=void 0,a=t=+this.getRightValue(n(me,t)),i=t,o=t),{min:i,max:o,start:e,end:a}}});function s(t,e,r){return t===e?r:t===r?e:t}function d(t,e,a){var n,i,o,l,d=t.borderWidth,h=function(t){var e=t.borderSkipped,r={};return e?(t.horizontal?t.base>t.x&&(e=s(e,"left","right")):t.base<t.y&&(e=s(e,"bottom","top")),r[e]=!0,r):r}(t);return r.isObject(d)?(n=+d.top||0,i=+d.right||0,o=+d.bottom||0,l=+d.left||0):n=i=o=l=+d||0,{t:h.top||n<0?0:n>a?a:n,r:h.right||i<0?0:i>e?e:i,b:h.bottom||o<0?0:o>a?a:o,l:h.left||l<0?0:l>e?e:l}}function h(t){return{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height}}function u(t,e,a){var n,i,o=a.barThickness,l=(e.stackCount,e.pixels[t]),s=r.isNullOrUndef(o)?function(t,e){var r,a,n,i,o=t._length;for(n=1,i=e.length;n<i;++n)o=Math.min(o,Math.abs(e[n]-e[n-1]));for(n=0,i=t.getTicks().length;n<i;++n)a=t.getPixelForTick(n),o=n>0?Math.min(o,Math.abs(a-r)):o,r=a;return o}(e.scale,e.pixels):-1;return 1,r.isNullOrUndef(o)?(n=s*a.categoryPercentage,i=a.barPercentage):(n=1*o,i=1),{chunk:n/1,ratio:i,start:l-n/2}}t.scaleService.registerScaleType("timeline",l,{position:"bottom",tooltips:{mode:"nearest"},adapters:{},time:{parser:!1,format:!1,unit:!1,round:!1,displayFormat:!1,isoWeekday:!1,minUnit:"millisecond",distribution:"linear",bounds:"data",displayFormats:{millisecond:"h:mm:ss.SSS a",second:"h:mm:ss a",minute:"h:mm a",hour:"hA",day:"MMM D",week:"ll",month:"MMM YYYY",quarter:"[Q]Q - YYYY",year:"YYYY"}},ticks:{autoSkip:!0}}),t.controllers.timeline=t.controllers.bar.extend({_dataElementOptions:["backgroundColor","borderColor","borderSkipped","borderWidth","hoverBackgroundColor","hoverBorderColor","hoverBorderWidth","barPercentage","barThickness","categoryPercentage","maxBarThickness","minBarLength","textPadding","showText","keyValue","keyStart","keyEnd"],update:function(t){var e,r,a=this.getMeta().data;for(this._ruler=this.getRuler(),e=0,r=a.length;e<r;++e)this.updateElement(a[e],e,t)},_updateElementGeometry:function(e,r,a,n){var i=this;t.controllers.bar.prototype._updateElementGeometry.apply(i,arguments);var o=i.getDataset().data[r],l=e._xScale.getPixelForValue(o,r,i.index,n.keyStart||0),s=e._xScale.getPixelForValue(o,r,i.index,n.keyEnd||1),u=o[n.keyValue||2],c=i.getRuler(r),g=i.calculateBarIndexPixels(i.index,r,c,n),f=e._yScale.getPixelForValue(i.index,i.index);e._model.x=l,e._model.width=s-l,e._model.y=f-g.size/2,e._model.height=g.size,e._model.textPadding=n.textPadding||4,e._model.textColor=n.textColor||t.defaults.global.defaultFontColor,n.showText,e._model.text=u,e.draw=function(){var t=this._chart.ctx,e=this._view,r=function(t){var e=h(t),r=e.right-e.left,a=e.bottom-e.top,n=d(t,r/2,a/2);return{outer:{x:e.left,y:e.top,w:r,h:a},inner:{x:e.left+n.l,y:e.top+n.t,w:r-n.l-n.r,h:a-n.t-n.b}}}(e),a=r.outer,n=r.inner;(t.fillStyle=e.backgroundColor,t.fillRect(a.x,a.y,a.w,a.h),a.w!==n.w||a.h!==n.h)&&(t.save(),t.beginPath(),t.rect(a.x,a.y,a.w,a.h),t.clip(),t.fillStyle=e.borderColor,t.rect(n.x,n.y,n.w,n.h),t.fill("evenodd"),t.restore(),e.text&&t.measureText(e.text).width>0&&(t.save(),t.beginPath(),t.rect(n.x,n.y,n.w,n.h),t.clip(),t.fillStyle=e.textColor,t.lineWidth=0,t.strokeStyle=e.textColor,t.textBaseline="middle",t.fillText(e.text,e.x+e.textPadding,e.y+e.height/2),t.restore()))},e.inXRange=function(t){var e=h(this._view);return t>=e.left&&t<=e.right},e.getCenterPoint=function(){var t=this._view;return{x:t.x+t.width/2,y:t.y+t.height/2}},e.inRange=function(t,e){var r=!1;if(this._view){var a=h(this._view);r=t>=a.left&&t<=a.right&&e>=a.top&&e<=a.bottom}return r},e.getArea=function(){var t=this._view;return t.height*Math.abs(t.x-t.base)},e.tooltipPosition=function(){var t=this.getCenterPoint();return{x:t.x,y:t.y}}},draw:function(t){var e,r,a=t||1,n=this.getMeta().data;for(e=0,r=n.length;e<r;e++)n[e].transition(a).draw()},calculateBarIndexPixels:function(t,e,a,n){var i="flex"===n.barThickness?function(t,e,r){var a,n=e.pixels,i=n[t],o=t>0?n[t-1]:null,l=t<n.length-1?n[t+1]:null,s=r.categoryPercentage;return null===o&&(o=i-(null===l?e.end-e.start:l-i)),null===l&&(l=i+i-o),a=i-(i-Math.min(o,l))/2*s,{chunk:Math.abs(l-o)/2*s/e.stackCount,ratio:r.barPercentage,start:a}}(e,a,n):u(e,a,n),o=this.getStackIndex(t,this.getMeta().stack),l=i.start+i.chunk*o+i.chunk/2,s=Math.min(r.valueOrDefault(n.maxBarThickness,1/0),i.chunk*i.ratio);return{base:l-s/2,head:l+s/2,center:l,size:s}},_resolveElementOptions:function(t,e){var a,n,i,o=this.chart,l=this.getDataset(),s=t.custom||{},d=o.options.elements||{},h={},u={chart:o,dataIndex:e,dataset:l,datasetIndex:this.index},c=["backgroundColor","borderColor","borderWidth","borderSkipped","hoverBackgroundColor","hoverBorderColor","hoverBorderWidth","barThickness","maxBarThickness","minBarLength","textPadding","textColor","showText","keyValue","keyStart","keyEnd"];for(a=0,n=c.length;a<n;++a)h[i=c[a]]=r.options.resolve([s[i],l[i],d[i]],u,e);return h},_getValueScaleId:function(){return this.getMeta().xAxisID},_getIndexScaleId:function(){return this.getMeta().yAxisID}}),t.defaults._set("global",{datasets:{timeline:{categoryPercentage:.8,barPercentage:.9}}}),t.defaults.timeline={elements:{backgroundColor:"gold",borderColor:"orange",borderWidth:2,borderSkipped:"left",hoverBackgroundColor:"orange",hoverBorderColor:"red",hoverBorderWidth:1,showText:!0,textPadding:4,minBarLength:5,keyStart:0,keyEnd:1,keyValue:2,categoryPercentage:.9,barPercentage:.7},layout:{padding:{left:0,right:0,top:0,bottom:0}},legend:{display:!1},scales:{xAxes:[{type:"timeline",position:"bottom",distribution:"linear",gridLines:{display:!0,drawBorder:!0,drawTicks:!0},ticks:{maxRotation:0},unit:"day"}],yAxes:[{type:"category",position:"left",offset:!0,gridLines:{display:!0,offsetGridLines:!0,drawBorder:!0,drawTicks:!0}}]},tooltips:{callbacks:{title:function(t,e){this._chart.options.elements;return e.labels[t[0].datasetIndex]},label:function(t,r){var a=this._chart.options.elements,n=r.datasets[t.datasetIndex].data[t.index];return[n[a.keyValue],e(n[a.keyStart]).format("L LTS"),e(n[a.keyEnd]).format("L LTS")]}}}}});
