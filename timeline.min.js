!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("chart.js"),require("moment")):"function"==typeof define&&define.amd?define(["chart.js","moment"],e):e(t.Chart,t.moment)}(this,function(t,e){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t,e=e&&e.hasOwnProperty("default")?e.default:e;var a=t.helpers;function r(t,r){if(a.isNullOrUndef(t))return null;var o=r.options.time,i=function(t,a){var r=a.parser,o=a.parser||a.format;return"function"==typeof r?r(t):"string"==typeof t&&"string"==typeof o?e(t,o):(t instanceof e||(t=e(t)),t.isValid()?t:"function"==typeof o?o(t):t)}(r.getRightValue(t),o);return i.isValid()?(o.round&&i.startOf(o.round),i.valueOf()):null}var o=Number.MIN_SAFE_INTEGER||-9007199254740991,i=Number.MAX_SAFE_INTEGER||9007199254740991,n=t.scaleService.getScaleConstructor("time").extend({determineDataLimits:function(){var t,a,n,l,s,d,h,c=this,u=c.chart,g=c.options.time,f=c.chart.options.elements,p=i,m=o,y=[],x={},b=[];for(t=0,n=(u.data.datasets||[]).length;t<n;++t)if(u.isDatasetVisible(t))for(s=u.data.datasets[t].data,b[t]=[],a=0,l=s.length;a<l;++a)(d=r(s[a][f.keyStart],c))>(h=r(s[a][f.keyEnd],c))&&([d,h]=[h,d]),p>d&&d&&(p=d),m<h&&h&&(m=h),b[t][a]=[d,h,s[a][f.keyValue]],Object.prototype.hasOwnProperty.call(x,d)&&(x[d]=!0,y.push(d)),Object.prototype.hasOwnProperty.call(x,h)&&(x[h]=!0,y.push(h));else b[t]=[];y.size&&y.sort(function(t,e){return t-e}),p=r(g.min,c)||p,m=r(g.max,c)||m,p=p===i?+e().startOf("day"):p,m=m===o?+e().endOf("day")+1:m,c.min=Math.min(p,m),c.max=Math.max(p+1,m),c._horizontal=c.isHorizontal(),c._table=[],c._timestamps={data:y,datasets:b,labels:[]}}});t.scaleService.registerScaleType("timeline",n,{position:"bottom",tooltips:{mode:"nearest"},adapters:{},time:{parser:!1,format:!1,unit:!1,round:!1,displayFormat:!1,isoWeekday:!1,minUnit:"millisecond",distribution:"linear",bounds:"data",displayFormats:{millisecond:"h:mm:ss.SSS a",second:"h:mm:ss a",minute:"h:mm a",hour:"hA",day:"MMM D",week:"ll",month:"MMM YYYY",quarter:"[Q]Q - YYYY",year:"YYYY"}},ticks:{autoSkip:!0}}),t.controllers.timeline=t.controllers.bar.extend({_dataElementOptions:["backgroundColor","borderColor","borderSkipped","borderWidth","hoverBackgroundColor","hoverBorderColor","hoverBorderWidth","barThickness","maxBarThickness","minBarLength","textPadding","showText","keyValue","keyStart","keyEnd"],getBarBounds:function(t){var e,a,r=t._view;return e=r.x,a=r.x+r.width,{left:e,top:r.y,right:a,bottom:r.y+r.height}},update:function(e){var r=this,o=r.getMeta(),i=r.chart.options;if(i.textPadding||i.minBarLength||i.showText||i.colorFunction){var n=r.chart.options.elements;n.textPadding=i.textPadding||n.textPadding,n.minBarLength=i.minBarLength||n.minBarLength,n.colorFunction=i.colorFunction||n.colorFunction,n.minBarLength=i.minBarLength||n.minBarLength,!0!==t._tl_depwarn&&(console.log("Timeline Chart: Configuration deprecated. Please check document on Github."),t._tl_depwarn=!0)}a.each(o.data,function(t,a){r.updateElement(t,a,e)},r)},updateElement:function(t,e,r){var o=this,i=o.getMeta(),n=o.getDataset(),l=o._resolveDataElementOptions(t,e),s=o.getScaleForId(i.xAxisID),d=o.getScaleForId(i.yAxisID),h=n.data[e],c=s.getPixelForValue(h[l.keyStart]),u=d.getPixelForValue(h,o.index,o.index),g=s.getPixelForValue(h[l.keyEnd])-c,f=o.getRuler(e),p=o.calculateBarHeight(f);t._xScale=o.getScaleForId(i.xAxisID),t._yScale=o.getScaleForId(i.yAxisID),t._datasetIndex=o.index,t._index=e,t._model={backgroundColor:l.backgroundColor,borderColor:l.borderColor,borderSkipped:l.borderSkipped,borderWidth:l.borderWidth,datasetLabel:n.label,label:o.chart.data.labels[e],x:r?c-g:c,y:u-p/2,width:Math.max(g,l.minBarLength),height:p,base:c+g,text:h[l.keyValue],textColor:a.color(l.backgroundColor).luminosity()>.5?"#000000":"#ffffff"};h[l.keyValue];var m=l.showText;t.draw=function(){var t=this._chart.ctx,e=this._view,a=t.globalAlpha,r=t.globalCompositeOperation;t.fillStyle=e.backgroundColor,t.lineWidth=e.borderWidth,t.globalCompositeOperation="destination-over",t.fillRect(e.x,e.y,e.width,e.height),t.globalAlpha=.5,t.globalCompositeOperation="source-over",t.fillRect(e.x,e.y,e.width,e.height);var o=e.borderWidth||0;if(o>0&&(t.save(),t.beginPath(),t.rect(e.x,e.y,e.width,e.height),t.clip(),t.fillStyle=e.borderColor,t.rect(e.x+o,e.y+o,e.width-2*o,e.height-2*o),t.fill("evenodd"),t.restore()),t.globalAlpha=a,t.globalCompositeOperation=r,m){t.beginPath();var i=t.measureText(e.text);i.width>0&&i.width+l.textPadding+2<e.width&&(l.font&&(t.font=l.font),t.fillStyle=e.textColor,t.lineWidth=0,t.strokeStyle=e.textColor,t.textBaseline="middle",t.fillText(e.text,e.x+l.textPadding,e.y+e.height/2)),t.fill()}},t.inXRange=function(t){var e=o.getBarBounds(this);return t>=e.left&&t<=e.right},t.tooltipPosition=function(){var t=this.getCenterPoint();return{x:t.x,y:t.y}},t.getCenterPoint=function(){var t=this._view;return{x:t.x+t.width/2,y:t.y+t.height/2}},t.inRange=function(t,e){var a=!1;if(this._view){var r=o.getBarBounds(this);a=t>=r.left&&t<=r.right&&e>=r.top&&e<=r.bottom}return a},t.pivot()},getBarCount:function(){var t=this,e=0;return a.each(t.chart.data.datasets,function(a,r){t.chart.getDatasetMeta(r).bar&&t.chart.isDatasetVisible(r)&&++e},t),e},draw:function(t){var e,a,r=t||1,o=this.getMeta().data;for(e=0,a=o.length;e<a;e++)o[e].transition(r).draw()},calculateBarHeight:function(t){var e=this.getScaleForId(this.getMeta().yAxisID);return e.options.barThickness?e.options.barThickness:e.options.stacked?t.categoryHeight:t.barHeight},_resolveDataElementOptions:function(t,e){var r=a.options.resolve,o=this,i=t&&t.custom,n=o._cachedDataOpts;if(n&&!i)return n;var l,s,d,h,c=o.chart,u=o._config,g=c.options.elements[o.dataElementType.prototype._type]||{},f=o._dataElementOptions,p={},m={chart:c,dataIndex:e,dataset:o.getDataset(),datasetIndex:o.index},y={cacheable:!i};if(i=i||{},a.isArray(f))for(s=0,d=f.length;s<d;++s)p[h=f[s]]=r([i[h],u[h],g[h]],m,e,y);else for(s=0,d=(l=Object.keys(f)).length;s<d;++s)p[h=l[s]]=r([i[h],u[f[h]],u[h],g[h]],m,e,y);g.keyStart||(g.keyStart=0),g.keyEnd||(g.keyEnd=1),g.keyValue||(g.keyValue=2),g.minBarLength||(g.minBarLength=40),g.showText||(g.showText=!0),g.textPadding||(g.textPadding=4),y.cacheable&&(o._cachedDataOpts=Object.freeze(p));o._getIndexScale().options,o._getValueScale().options;return p},_getValueScaleId:function(){return this.getMeta().xAxisID},_getIndexScaleId:function(){return this.getMeta().yAxisID}}),t.defaults.timeline={elements:{backgroundColor:"gold",borderColor:"orange",borderWidth:2,hoverBackgroundColor:"orange",hoverBorderColor:"red",hoverBorderWidth:1,showText:!0,textPadding:4,minBarLength:5,keyStart:0,keyEnd:1,keyValue:2},layout:{padding:{left:0,right:0,top:0,bottom:0}},legend:{display:!1},scales:{xAxes:[{type:"timeline",position:"bottom",distribution:"linear",gridLines:{display:!0,drawBorder:!0,drawTicks:!0},ticks:{maxRotation:0},unit:"day"}],yAxes:[{type:"category",position:"left",barThickness:20,categoryPercentage:.9,barPercentage:.7,offset:!0,gridLines:{display:!0,offsetGridLines:!0,drawBorder:!0,drawTicks:!0}}]},tooltips:{callbacks:{title:function(t,e){this._chart.options.elements;return e.labels[t[0].datasetIndex]},label:function(t,a){var r=this._chart.options.elements,o=a.datasets[t.datasetIndex].data[t.index];return[o[r.keyValue],e(o[r.keyStart]).format("L LTS"),e(o[r.keyEnd]).format("L LTS")]}}}}});
